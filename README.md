# โครงการ: การขุดบิตคอยน์ด้วย CPU - คนธรรมดาก็เข้าร่วมได้ บิตคอยน์คือไร้ศูนย์

## ภาพรวม
โครงการนี้มุ่งพัฒนาระบบการขุดบิตคอยน์ (Bitcoin Mining) โดยใช้ **CPU** เพื่อให้ **คนธรรมดา** ที่ไม่มีอุปกรณ์ขุดเฉพาะทาง (เช่น ASIC) สามารถเข้าร่วมการขุดได้ ผ่านแนวคิดของ **พูลขุดขนาดเล็ก** (Small Mining Pool) ที่กระจายงานขุดไปยังเครื่องคอมพิวเตอร์หลายเครื่อง โดยยึดหลักการของบิตคอยน์ที่ **ไร้ศูนย์กลาง** (Decentralized) ซึ่งทุกคนมีส่วนร่วมในเครือข่ายได้อย่างเท่าเทียม

ระบบนี้พัฒนาด้วย **Python** และออกแบบให้ทำงานในสภาพแวดล้อมที่ควบคุมได้ เช่น **regtest** หรือ **testnet** เพื่อการทดสอบและการศึกษา หรือในกรณีเฉพาะบน **mainnet** สำหรับผู้ที่ต้องการทดลองขุดจริง โครงการนี้ไม่เน้นกำไรจากการขุด (เนื่องจาก CPU มีประสิทธิภาพต่ำเมื่อเทียบกับ ASIC) แต่เน้นการสร้างความเข้าใจและส่งเสริมการมีส่วนร่วมในเครือข่ายบิตคอยน์

## หลักการของบิตคอยน์: ไร้ศูนย์กลาง
บิตคอยน์เป็นสกุลเงินดิจิทัลที่ทำงานบนเครือข่ายแบบ **ไร้ศูนย์กลาง** โดยไม่มีหน่วยงานกลางควบคุม การทำงานของเครือข่ายอาศัย:
- **โหนด** (Nodes): เก็บและตรวจสอบบล็อกเชน
- **นักขุด** (Miners): ใช้พลังคำนวณเพื่อแก้ปัญหาคณิตศาสตร์ (Proof-of-Work) สร้างบล็อกใหม่ และรับรางวัล (Block Reward)

ในปี 2025 รางวัลต่อบล็อกอยู่ที่ **3.125 BTC** (หลัง Halving ปี 2024) การขุดด้วย CPU มีประสิทธิภาพต่ำ แต่โครงการนี้ใช้พูลขนาดเล็กเพื่อรวมพลังคำนวณจากเครื่องหลายเครื่อง

**ไร้ศูนย์กลาง** หมายถึง:
- ทุกคนสามารถรันโหนดหรือขุดได้โดยไม่ต้องขออนุญาต
- การตัดสินใจในเครือข่ายเกิดจากฉันทามติ (Consensus)
- โครงการนี้ให้คนทั่วไปมีส่วนร่วมโดยใช้คอมพิวเตอร์ธรรมดา

## โครงสร้างของระบบ
ระบบประกอบด้วยสามส่วนหลัก:
1. **Pool Server (`pool_server.py`)**
   - ตัวกลางจัดการงานขุด
   - ดึง **block template** จาก Bitcoin node ผ่าน JSON-RPC
   - แบ่งช่วง **nonce** ส่งให้ worker
   - รับผลลัพธ์และส่งบล็อกที่ขุดได้ไปยัง Bitcoin node
   - รองรับ worker หลายตัว (ทั้งในเครื่องเดียวและข้ามเครือข่าย)

2. **Worker (`worker.py`)**
   - รันบนเครื่องคอมพิวเตอร์ของผู้เข้าร่วม
   - รับช่วง nonce และขุดโดยใช้ CPU
   - ส่งผลลัพธ์ (nonce ที่พบหรือยืนยันว่าไม่มี) กลับไปยังเซิร์ฟเวอร์
   - รายงานอัตราแฮช (hash rate)

3. **Shared Functions (`original_script.py`)**
   - โมดูลรวมฟังก์ชัน เช่น การคำนวณ SHA-256, สร้าง coinbase transaction, และสื่อสาร RPC
   - ลดการซ้ำซ้อนของโค้ด

## คุณสมบัติ
- **การเข้าถึง**: ใช้คอมพิวเตอร์ทั่วไป เหมาะสำหรับ regtest/testnet หรือการศึกษา
- **ไร้ศูนย์กลาง**: ผู้ใช้ควบคุมเซิร์ฟเวอร์และ worker ได้เอง ไม่พึ่งพาพูลขนาดใหญ่
- **ยืดหยุ่น**: รองรับ mainnet, testnet, regtest และปรับแต่งช่วง nonce ได้
- **การศึกษา**: ช่วยให้ผู้ใช้เรียนรู้การขุด, Proof-of-Work, และบล็อกเชน

## การทำงาน
1. **เซิร์ฟเวอร์เริ่มต้น**:
   - เชื่อมต่อ Bitcoin node (เช่น `bitcoind`) เพื่อดึง block template
   - สร้าง coinbase transaction ด้วยที่อยู่รางวัล (เช่น `bc1qmuhxdy836dxertx98s60z24slhpggumrplzcp8`)
   - คำนวณ Merkle root และสร้าง block header

2. **แจกจ่ายงาน**:
   - แบ่งช่วง nonce (เช่น 1 ล้าน nonce ต่อ worker) ส่งผ่าน TCP socket (พอร์ต `8335`)
   - รองรับ worker จาก IP เช่น `127.0.0.1` และ `192.168.1.145`

3. **การขุด**:
   - Worker คำนวณ double SHA-256 hash สำหรับแต่ละ nonce
   - ส่ง nonce ที่พบ (ถ้ามี) หรือรายงานว่าไม่มี nonce ที่เหมาะสม

4. **ส่งบล็อก**:
   - เซิร์ฟเวอร์สร้างบล็อกสมบูรณ์และส่งผ่าน RPC (`submitblock`)
   - แจ้ง worker เพื่อเริ่มงานใหม่หากบล็อกได้รับการยอมรับ

## ความท้าทาย
1. **ประสิทธิภาพ CPU**:
   - อัตราแฮชต่ำ (<1 MH/s ต่อคอร์) เทียบกับ ASIC (TH/s)
   - เหมาะสำหรับ regtest/testnet มากกว่า mainnet

2. **การจัดการพูล**:
   - ต้องตั้งค่าเครือข่าย (เช่น เปิดพอร์ต `8335`) และดูแลเซิร์ฟเวอร์
   - Worker ระยะไกลต้องตั้งค่า IP/ไฟร์วอลล์

3. **ความซับซ้อน**:
   - ต้องติดตั้ง Bitcoin Core, Python, และจัดการ RPC
   - การดีบัก (เช่น ข้อผิดพลาด `reward_address`) อาจท้าทาย

## วิธีที่คนธรรมดาเข้าร่วม
1. **ติดตั้ง**:
   - ติดตั้ง Python และโมดูล:
     ```bash
     pip install requests bech32
     ```
   - รัน Bitcoin Core ใน regtest:
     ```bash
     bitcoind -regtest -daemon
     bitcoin-cli -regtest createwallet testwallet
     bitcoin-cli -regtest generatetoaddress 101 $(bitcoin-cli -regtest getnewaddress)
     ```

2. **รัน Worker**:
   - คัดลอก `worker.py` และ `original_script.py` ไปยังเครื่อง
   - ตั้งค่า `SERVER_HOST` และ `SERVER_PORT` (เช่น `8335`):
     ```python
     SERVER_HOST = "192.168.1.x"  # IP ของเซิร์ฟเวอร์
     SERVER_PORT = 8335
     ```
   - รัน:
     ```bash
     python worker.py
     ```

3. **เข้าร่วมพูล**:
   - เชื่อมต่อกับเซิร์ฟเวอร์ของชุมชนหรือรันเซิร์ฟเวอร์เอง
   - เพิ่ม worker จากเครื่องหลายเครื่องเพื่อรวมพลังคำนวณ

4. **เรียนรู้**:
   - ศึกษาโค้ด open-source เพื่อเข้าใจการขุดและบล็อกเชน
   - ทดลองใน regtest เพื่อจำลองการขุด

## การตั้งค่า
### ความต้องการ
- **ซอฟต์แวร์**: Python 3.6+, Bitcoin Core, `requests`, `bech32`
- **ไฟล์**:
  - `pool_server.py`: รันบนเครื่องที่มี Bitcoin node
  - `worker.py`: รันบนเครื่องขุด
  - `original_script.py`: โมดูลฟังก์ชันร่วม
- **เครือข่าย**:
  - เซิร์ฟเวอร์: เปิดพอร์ต `8335`
  - Worker: ตั้งค่า IP เซิร์ฟเวอร์ให้ถูกต้อง

### ขั้นตอนการติดตั้ง
1. **ติดตั้ง Bitcoin Core**:
   - ดาวน์โหลดและรัน `bitcoind` หรือ `bitcoin-qt`
   - ตั้งค่า `bitcoin.conf`:
     ```conf
     rpcuser=user
     rpcpassword=password
     server=1
     rpcallowip=127.0.0.1
     ```

2. **ติดตั้ง Python และโมดูล**:
   ```bash
   python -m venv venv
   source venv/bin/activate
   pip install requests bech32

# การตั้งค่าระบบการขุดบิตคอยน์ด้วย CPU

เอกสารนี้อธิบายขั้นตอนการตั้งค่าไฟล์และรันระบบการขุดบิตคอยน์ด้วย CPU สำหรับพูลขุดขนาดเล็ก โดยใช้ `pool_server.py`, `worker.py`, และ `original_script.py` ซึ่งเป็นส่วนหนึ่งของโครงการ "คนธรรมดาก็เข้าร่วมได้ - บิตคอยน์คือไร้ศูนย์"

## การตั้งค่าไฟล์

1. **วางไฟล์ในไดเรกทอรี**:
   - คัดลอกไฟล์ต่อไปนี้ไปยังไดเรกทอรีที่ต้องการ เช่น `~/Documents/Dev/mining`:
     - `pool_server.py` (เซิร์ฟเวอร์พูลขุด)
     - `worker.py` (ไคลเอนต์สำหรับการขุด)
     - `original_script.py` (โมดูลฟังก์ชันร่วม)
   - สร้างไดเรกทอรีหากยังไม่มี:
     ```bash
     mkdir -p ~/Documents/Dev/mining
     ```
   - ย้ายหรือคัดลอกไฟล์ไปยังไดเรกทอรี:
     ```bash
     cp pool_server.py worker.py original_script.py ~/Documents/Dev/mining/
     ```

2. **อัปเดตการตั้งค่าใน `original_script.py`**:
   - เปิดไฟล์ `original_script.py` ในตัวแก้ไขข้อความ (เช่น `nano`):
     ```bash
     nano ~/Documents/Dev/mining/original_script.py
     ```
   - อัปเดตตัวแปรต่อไปนี้ให้ตรงกับการตั้งค่าของคุณ:
     - `reward_address`: ที่อยู่บิตคอยน์สำหรับรับรางวัลการขุด
       - สำหรับ mainnet: ใช้ที่อยู่ที่เริ่มด้วย `bc1q` (เช่น `bc1qmuhxdy836dxertx98s60z24slhpggumrplzcp8`)
       - สำหรับ regtest: ใช้ที่อยู่ที่เริ่มด้วย `bcrt` (สร้างด้วย `bitcoin-cli -regtest getnewaddress`)
       - ตัวอย่าง:
         ```python
         reward_address = "bc1qmuhxdy836dxertx98s60z24slhpggumrplzcp8"
         ```
     - `rpc_url`: URL ของ Bitcoin node สำหรับการสื่อสาร RPC
       - Mainnet: `http://127.0.0.1:8332`
       - Regtest: `http://127.0.0.1:18443`
       - ตัวอย่าง:
         ```python
         rpc_url = "http://127.0.0.1:8332"
         ```
   - ตรวจสอบว่า `rpc_user` และ `rpc_password` ตรงกับการตั้งค่าใน `~/.bitcoin/bitcoin.conf`:
     ```python
     rpc_user = "user"
     rpc_password = "password"
     ```
   - บันทึกและปิดไฟล์

## รันระบบ

### ข้อกำหนดเบื้องต้น
- ติดตั้ง **Bitcoin Core** และรัน `bitcoind` หรือ `bitcoin-qt`
- ติดตั้ง **Python 3.6+** และโมดูล:
  ```bash
  python -m venv venv
  source venv/bin/activate
  pip install requests bech32